<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .hidden {
            display: none !important;
        }

        /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
        .main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            position: relative;
            padding: 2rem;
        }

        .game-title {
            font-size: 5rem;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.6);
            background: linear-gradient(45deg, #ff6b6b, #ffa500, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 3rem;
            font-weight: bold;
        }

        .coins-display {
            font-size: 2rem;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 2rem;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 300px;
            margin-bottom: 2rem;
        }

        .menu-button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 18px 30px;
            font-size: 1.3rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .menu-button.start {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .menu-button.achievements {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .menu-button.shop {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .bottom-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .round-button {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            font-size: 2.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .round-button:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.25);
        }

        /* –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò */
        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 90%;
            margin: 1rem;
            max-height: 90%;
            overflow-y: auto;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #ffd700;
        }

        p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            opacity: 0.9;
            line-height: 1.4;
        }

        .btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
            display: inline-block;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }

        .settings {
            margin: 1.5rem 0;
            text-align: left;
        }

        .setting-item {
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .setting-label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: bold;
            font-size: 1.1rem;
            color: #ffd700;
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
        }

        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
        }

        .timer {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
        }

        .timer.low-time {
            color: #ff6b6b;
            animation: pulse 0.8s infinite;
        }

        .target {
            font-size: 1.3rem;
            text-align: center;
            color: #fff;
        }

        .target-emoji {
            font-size: 2rem;
            display: block;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .level {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coins-counter {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .loading {
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .game-area {
            width: 100%;
            height: 100%;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        /* –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –ü–û–ò–°–ö–ê */
        .search-tool {
            position: absolute;
            pointer-events: none;
            z-index: 10;
            transition: transform 0.1s ease;
        }

        .flashlight-beam {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0.2) 30%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 70%
            );
            filter: blur(5px);
        }

        .chinese-lantern-beam {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 100, 100, 0.4) 0%,
                rgba(255, 80, 80, 0.3) 30%,
                rgba(255, 60, 60, 0.2) 50%,
                transparent 70%
            );
            filter: blur(6px);
        }

        .magnifier-beam {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 255, 255, 0.4) 0%,
                rgba(255, 255, 255, 0.3) 40%,
                rgba(255, 255, 255, 0.2) 60%,
                transparent 80%
            );
            border: 2px solid rgba(255, 255, 255, 0.8);
            filter: none;
        }

        .candle-beam {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(255, 200, 50, 0.25) 0%,
                rgba(255, 180, 50, 0.15) 20%,
                rgba(255, 160, 50, 0.08) 40%,
                transparent 60%
            );
            filter: blur(8px) brightness(0.8);
            opacity: 0.7;
        }

        .brush-container {
            position: relative;
            width: 110px;
            height: 110px;
        }

        .brush-beam {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                rgba(100, 200, 255, 0.1) 0%,
                rgba(100, 200, 255, 0.05) 30%,
                transparent 50%
            );
            border: 1px dashed rgba(100, 200, 255, 0.3);
            animation: brushClean 2s ease-in-out infinite;
            transform-origin: center;
        }

        .bubble {
            position: absolute;
            font-size: 1rem;
            opacity: 0;
            animation: bubbleFloat 2s ease-in forwards;
            z-index: 20;
        }

        @keyframes brushClean {
            0%, 100% { 
                transform: rotate(-10deg) scale(1);
                opacity: 0.6;
            }
            25% { 
                transform: rotate(5deg) scale(1.1);
                opacity: 0.8;
            }
            50% { 
                transform: rotate(-5deg) scale(0.9);
                opacity: 0.7;
            }
            75% { 
                transform: rotate(10deg) scale(1.05);
                opacity: 0.9;
            }
        }

        @keyframes bubbleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-20px) scale(1.1);
            }
            100% {
                opacity: 0;
                transform: translateY(-40px) scale(1.2);
            }
        }

        .tool-icon {
            position: absolute;
            font-size: 1.5rem;
            z-index: 15;
            pointer-events: none;
            filter: drop-shadow(0 0 5px yellow);
        }

        .emoji {
            position: absolute;
            z-index: 5;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
            transform-origin: center;
        }

        .emoji.visible {
            opacity: 1;
        }

        .emoji.highlighted {
            animation: highlightPulse 1.5s ease-in-out infinite;
            opacity: 1 !important;
        }

        @keyframes highlightPulse {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 3px cyan);
            }
            50% { 
                transform: scale(1.05);
                filter: drop-shadow(0 0 10px cyan);
            }
        }

        .left-handed .tool-icon {
            transform: scaleX(-1);
            left: -25px;
        }

        .right-handed .tool-icon {
            right: -25px;
        }

        .pause-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .pause-content {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-type-indicator {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            z-index: 101;
            text-align: center;
        }

        .item-found {
            animation: itemFound 0.8s ease-out forwards;
            z-index: 100;
        }

        @keyframes itemFound {
            0% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.3);
                opacity: 0.7;
            }
            100% { 
                transform: scale(0);
                opacity: 0;
            }
        }

        .detection-zone {
            position: absolute;
            border: 2px solid rgba(0, 255, 0, 0.5);
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            display: none;
        }

        /* –î–û–°–¢–ò–ñ–ï–ù–ò–Ø */
        .achievements-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .achievement {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 15px;
            border: 2px solid #666;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .achievement.locked {
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        .achievement.unlocked {
            border-color: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);
        }

        .achievement-icon {
            font-size: 2.5rem;
            min-width: 60px;
            text-align: center;
        }

        .achievement-info {
            flex: 1;
            text-align: left;
        }

        .achievement-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 0.3rem;
        }

        .achievement-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* –ú–ê–ì–ê–ó–ò–ù */
        .shop-categories {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .category-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .category-btn.active {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 15px;
            border: 2px solid #666;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }

        .shop-item.owned {
            border-color: #2ecc71;
            opacity: 0.7;
        }

        .shop-item.can-afford {
            border-color: #3498db;
            cursor: pointer;
        }

        .shop-item.can-afford:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .shop-item.cannot-afford {
            border-color: #666;
            opacity: 0.5;
        }

        .shop-icon {
            font-size: 2.5rem;
            min-width: 60px;
            text-align: center;
        }

        .shop-info {
            flex: 1;
            text-align: left;
        }

        .shop-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 0.3rem;
        }

        .shop-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .shop-price {
            font-size: 1rem;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* –Ø–ó–´–ö–ò */
        .language-option {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .language-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .language-option.selected {
            background: rgba(52, 152, 219, 0.3);
            border: 1px solid #3498db;
        }

        .language-flag {
            font-size: 1.5rem;
            min-width: 30px;
        }

        .language-name {
            flex: 1;
            font-weight: bold;
        }

        .language-code {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .hieroglyph {
            font-family: 'Segoe UI Symbol', sans-serif;
        }

        .pig-language {
            font-family: 'Arial', sans-serif;
        }

        /* –û–ö–ù–û –ü–û–ú–û–©–ò */
        .help-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .help-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .help-content h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: #ffa500;
        }

        .help-section {
            margin-bottom: 1.5rem;
        }

        .help-section h3 {
            color: #ffd700;
            margin-bottom: 0.5rem;
        }

        .help-section p {
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô */
        .emoji.detecting {
            animation: detectingPulse 0.5s ease-in-out;
        }

        @keyframes detectingPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .detection-timer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            z-index: 6;
            white-space: nowrap;
        }

        /* –£–í–ï–õ–ò–ß–ï–ù–ù–û–ï –û–ö–ù–û –ù–ê–°–¢–†–û–ï–ö */
        .settings-container {
            max-width: 95%;
            max-height: 85%;
            overflow-y: auto;
        }

        /* –£–ë–†–ê–¢–¨ –ò–ù–°–¢–†–£–ö–¶–ò–Æ –° –ò–ì–†–û–í–û–ì–û –ü–û–õ–Ø */
        .instructions {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div id="startScreen" class="screen">
        <div class="main-menu">
            <div class="game-title" id="gameTitle">üïµÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ</div>
            
            <div class="coins-display">
                <span>ü™ô</span>
                <span id="totalCoins">0</span>
            </div>
            
            <div class="menu-buttons">
                <button class="menu-button start" id="startButton">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                <button class="menu-button achievements" id="achievementsButton">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
                <button class="menu-button shop" id="shopButton">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</button>
            </div>
            
            <div class="bottom-buttons">
                <button class="round-button" id="helpButton">‚ùì</button>
                <button class="round-button" id="settingsButton">‚öôÔ∏è</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsScreen" class="screen hidden">
        <div class="container settings-container">
            <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            
            <div class="settings">
                <div class="setting-item">
                    <span class="setting-label">–†—É–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</span>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="hand" value="right" checked>
                            <span>–ü—Ä–∞–≤—à–∞ üîç</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="hand" value="left">
                            <span>–õ–µ–≤—à–∞ üîé</span>
                        </label>
                    </div>
                </div>
                
                <div class="setting-item">
                    <span class="setting-label">–¢–∏–ø —Ñ–æ–Ω–∞—Ä–∏–∫–∞:</span>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="flashlight" value="human" checked>
                            <span>–î–ª—è –ª—é–¥–µ–π üî¶</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="flashlight" value="chinese">
                            <span>–î–ª—è –∫–∏—Ç–∞–π—Ü–µ–≤ üèÆ</span>
                        </label>
                    </div>
                </div>

                <div class="setting-item">
                    <span class="setting-label">–Ø–∑—ã–∫:</span>
                    <div class="language-list">
                        <div class="language-option selected" data-lang="ru">
                            <span class="language-flag">üá∑üá∫</span>
                            <span class="language-name">–†—É—Å—Å–∫–∏–π</span>
                            <span class="language-code">RU</span>
                        </div>
                        <div class="language-option" data-lang="ua">
                            <span class="language-flag">üá∫üá¶</span>
                            <span class="language-name pig-language">üêñüêñüêñüêñüêñüêñ</span>
                            <span class="language-code pig-language">üêñüêñ</span>
                        </div>
                        <div class="language-option hieroglyph" data-lang="hieroglyph">
                            <span class="language-flag">ìÅπìÇÄìÄ†</span>
                            <span class="language-name">ìÇßìÇãìÜëìèèìäñ</span>
                            <span class="language-code">ìÇßìÇãìÜëìèèìäñ</span>
                        </div>
                        <div class="language-option" data-lang="klingon">
                            <span class="language-flag">üõ∏</span>
                            <span class="language-name">tlhIngan Hol</span>
                            <span class="language-code">tlhIngan</span>
                        </div>
                        <div class="language-option" data-lang="enochian">
                            <span class="language-flag">üëÅÔ∏è</span>
                            <span class="language-name">ENOCHIAN</span>
                            <span class="language-code">ENCH</span>
                        </div>
                        <div class="language-option" data-lang="sith">
                            <span class="language-flag">‚ö°</span>
                            <span class="language-name">UR-KITTƒÄT</span>
                            <span class="language-code">UR-KITTƒÄT</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 2rem;">
                <button id="backButton" class="btn" style="padding: 15px 40px; font-size: 1.2rem;">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –ø–æ–º–æ—â–∏ -->
    <div id="helpScreen" class="screen hidden">
        <div class="help-overlay">
            <div class="help-content">
                <h2>‚ùì –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h2>
                
                <div class="help-section">
                    <h3>üéØ –¶–µ–ª—å –∏–≥—Ä—ã</h3>
                    <p>–ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ —Ç–µ–º–Ω–æ—Ç–µ –∑–∞ 60 —Å–µ–∫—É–Ω–¥!</p>
                    <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∫—Ä—ã—Ç—ã—Ö —ç–º–æ–¥–∑–∏.</p>
                </div>

                <div class="help-section">
                    <h3>üëÜ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <p>‚Ä¢ –í–æ–¥–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –ø–æ —ç–∫—Ä–∞–Ω—É —á—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</p>
                    <p>‚Ä¢ –ù–∞–π–¥–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–π —ç–º–æ–¥–∑–∏ —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å</p>
                    <p>‚Ä¢ <strong>–î–≤–æ–π–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ</strong> - –ø–∞—É–∑–∞ –∏–≥—Ä—ã</p>
                </div>

                <div class="help-section">
                    <h3>üí∞ –ñ—ã—Ä–∫–æ–∏–Ω—ã</h3>
                    <p>‚Ä¢ –ó–∞ –∫–∞–∂–¥—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç: <strong>10ü™ô</strong></p>
                    <p>‚Ä¢ –ö–æ–ø–∏—Ç–µ –∂—ã—Ä–∫–æ–∏–Ω—ã –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ!</p>
                </div>

                <div class="help-section">
                    <h3>üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
                    <p>‚Ä¢ <strong>üî¶ –§–æ–Ω–∞—Ä–∏–∫</strong> - –æ–±—ã—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ</p>
                    <p>‚Ä¢ <strong>üîç –õ—É–ø–∞</strong> - —á–µ—Ç–∫–∏–π –∫—Ä—É–≥</p>
                    <p>‚Ä¢ <strong>üïØÔ∏è –°–≤–µ—á–∞</strong> - —Å–ª–∞–±–æ–µ –∂–µ–ª—Ç–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ</p>
                    <p>‚Ä¢ <strong>ü™• –ö–∏—Å—Ç—å</strong> - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</p>
                </div>

                <div class="help-section">
                    <h3>üïê –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h3>
                    <p>‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç –Ω—É–∂–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤ —Å–≤–µ—Ç–µ <strong>0.5 —Å–µ–∫—É–Ω–¥—ã</strong></p>
                    <p>‚Ä¢ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—Å–≤–µ—Ç–∏—Ç—å —Ö–æ—Ç—è –±—ã –ø–æ–ª–æ–≤–∏–Ω—É –ø—Ä–µ–¥–º–µ—Ç–∞</p>
                    <p>‚Ä¢ –¢–∞–π–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è</p>
                    <p>‚Ä¢ –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞–π–¥–µ–Ω–Ω—ã–º</p>
                </div>

                <button id="closeHelpButton" class="btn" style="margin-top: 1rem; padding: 12px 40px; font-size: 1.1rem;">–ü–æ–Ω—è—Ç–Ω–æ!</button>
            </div>
        </div>
    </div>

    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
    <div id="achievementsScreen" class="screen hidden">
        <div class="container">
            <h1>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h1>
            <div class="achievements-grid" id="achievementsGrid">
                <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            <button id="backFromAchievements" class="btn">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω -->
    <div id="shopScreen" class="screen hidden">
        <div class="container">
            <h1>üõí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h1>
            <div class="coins-display" style="margin-bottom: 1.5rem; font-size: 1.5rem; padding: 10px 20px;">
                <span>ü™ô</span>
                <span id="shopCoins">0</span>
            </div>
            
            <div class="shop-categories">
                <button class="category-btn active" data-category="appearance">–ù–∞–∑–≤–∞–Ω–∏—è</button>
                <button class="category-btn" data-category="upgrades">–£–ª—É—á—à–µ–Ω–∏—è</button>
            </div>
            
            <div class="shop-grid" id="shopGrid">
                <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            <button id="backFromShop" class="btn">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="gameScreen" class="screen hidden">
        <div class="game-header">
            <div class="timer" id="timer">60—Å</div>
            <div class="target">
                –¶–µ–ª—å: <span class="target-emoji" id="targetEmoji">üîç</span>
            </div>
            <div class="level">
                –£—Ä: <span id="level">1</span>
            </div>
            <div class="coins-counter">
                <span>ü™ô</span>
                <span id="coins">0</span>
            </div>
        </div>

        <div class="game-type-indicator" id="gameTypeIndicator">üî¶ –§–æ–Ω–∞—Ä–∏–∫</div>
        
        <div id="gameArea" class="game-area">
            <div class="detection-zone" id="detectionZone"></div>
        </div>
        
        <div class="search-tool" id="searchTool">
            <div class="flashlight-beam" id="toolBeam"></div>
            <div class="tool-icon" id="toolIcon">üî¶</div>
        </div>

        <div id="pauseScreen" class="pause-overlay hidden">
            <div class="pause-content">
                <h2>‚è∏Ô∏è –ü–∞—É–∑–∞</h2>
                <p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
                <button id="resumeButton" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                <button id="quitButton" class="btn btn-secondary">–í—ã–π—Ç–∏ –≤ –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div id="resultScreen" class="screen hidden">
        <div class="container">
            <h1>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h1>
            <p id="resultMessage"></p>
            <p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="earnedCoins">0</span>ü™ô</p>
            <button id="restartButton" class="btn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button id="menuButton" class="btn btn-secondary">–ú–µ–Ω—é</button>
        </div>
    </div>

    <script>
        // –≠–õ–ï–ú–ï–ù–¢–´ –ò–ì–†–´
        const startScreen = document.getElementById('startScreen');
        const settingsScreen = document.getElementById('settingsScreen');
        const helpScreen = document.getElementById('helpScreen');
        const achievementsScreen = document.getElementById('achievementsScreen');
        const shopScreen = document.getElementById('shopScreen');
        const gameScreen = document.getElementById('gameScreen');
        const resultScreen = document.getElementById('resultScreen');
        const pauseScreen = document.getElementById('pauseScreen');
        
        const startButton = document.getElementById('startButton');
        const settingsButton = document.getElementById('settingsButton');
        const helpButton = document.getElementById('helpButton');
        const achievementsButton = document.getElementById('achievementsButton');
        const shopButton = document.getElementById('shopButton');
        const closeHelpButton = document.getElementById('closeHelpButton');
        const backButton = document.getElementById('backButton');
        const backFromAchievements = document.getElementById('backFromAchievements');
        const backFromShop = document.getElementById('backFromShop');
        const restartButton = document.getElementById('restartButton');
        const menuButton = document.getElementById('menuButton');
        const resumeButton = document.getElementById('resumeButton');
        const quitButton = document.getElementById('quitButton');
        const gameTitle = document.getElementById('gameTitle');
        
        const gameArea = document.getElementById('gameArea');
        const timerElement = document.getElementById('timer');
        const targetEmoji = document.getElementById('targetEmoji');
        const levelElement = document.getElementById('level');
        const coinsElement = document.getElementById('coins');
        const totalCoinsElement = document.getElementById('totalCoins');
        const shopCoinsElement = document.getElementById('shopCoins');
        const earnedCoinsElement = document.getElementById('earnedCoins');
        const gameTypeIndicator = document.getElementById('gameTypeIndicator');
        const resultMessage = document.getElementById('resultMessage');
        const searchTool = document.getElementById('searchTool');
        const toolBeam = document.getElementById('toolBeam');
        const toolIcon = document.getElementById('toolIcon');
        const detectionZone = document.getElementById('detectionZone');
        const achievementsGrid = document.getElementById('achievementsGrid');
        const shopGrid = document.getElementById('shopGrid');

        // –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´
        const gameTime = 60; // –ò–∑–º–µ–Ω–µ–Ω–æ —Å 30 –Ω–∞ 60 —Å–µ–∫—É–Ω–¥
        let timeLeft = gameTime;
        let currentLevel = 1;
        let gameTimer;
        let isGameRunning = false;
        let isPaused = false;
        let currentTarget = '';
        let emojis = [];
        let currentTool = 'flashlight';
        let brushBubbles = [];
        let lastBrushTime = 0;
        let itemFound = false;
        let coins = 0;
        let totalCoins = 0;
        let lastTapTime = 0;
        let garlicFound = false;
        let activeUpgrades = {
            flashlightBoost: false,
            magnet: false
        };

        // –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –ó–ê–î–ï–†–ñ–ö–ò –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø
        let detectionTimers = new Map(); // –•—Ä–∞–Ω–∏—Ç —Ç–∞–π–º–µ—Ä—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–º–æ–¥–∑–∏
        const DETECTION_DELAY = 500; // 0.5 —Å–µ–∫—É–Ω–¥—ã –∑–∞–¥–µ—Ä–∂–∫–∏

        // –ù–ê–°–¢–†–û–ô–ö–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        let settings = {
            hand: 'right',
            flashlight: 'human',
            language: 'ru',
            character: 'üïµÔ∏è',
            gameTitle: '–î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ'
        };

        // –î–û–°–¢–ò–ñ–ï–ù–ò–Ø
        const achievements = [
            {
                id: 'speedster',
                name: '–ù—É —Ç—ã —Å–∫–æ—Ä–æ—Å—Ç—Ä–µ–ªüòÆ',
                description: '–î–æ—Å—Ç–∏—á—å 8 —É—Ä–æ–≤–Ω—è –∑–∞ 60 —Å–µ–∫—É–Ω–¥',
                icon: 'üí¶',
                unlocked: false,
                condition: (gameData) => gameData.level >= 8 && gameData.timeLeft > 0
            },
            {
                id: 'garlic',
                name: '–§—Éü§¢',
                description: '–ù–∞–π—Ç–∏ —á–µ—Å–Ω–æ–∫',
                icon: 'üßÑ',
                unlocked: false,
                condition: (gameData) => gameData.garlicFound
            }
        ];

        // –ú–ê–ì–ê–ó–ò–ù - –ò–°–ü–†–ê–í–õ–ï–ù–û: –í–°–ï –ù–ê–ó–í–ê–ù–ò–Ø –ë–ï–°–ü–õ–ê–¢–ù–´
        const shopItems = [
            // –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ - –í–°–ï –ù–ê–ó–í–ê–ù–ò–Ø –ë–ï–°–ü–õ–ê–¢–ù–´
            {
                id: 'detective',
                name: 'üïµÔ∏è –î–µ—Ç–µ–∫—Ç–∏–≤',
                description: '–ù–∞—á–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ',
                icon: 'üïµÔ∏è',
                price: 0,
                owned: true,
                type: 'appearance',
                category: 'appearance'
            },
            {
                id: 'pregnant',
                name: 'ü´Ñ –î–∞–≥–µ—Å—Ç–∞–Ω–µ—Ü',
                description: '–î–∞–≥–µ—Å—Ç–∞–Ω–µ—Ü –≤ –¢–µ–º–Ω–æ—Ç–µ',
                icon: 'ü´Ñ',
                price: 0,
                owned: true,
                type: 'appearance',
                category: 'appearance'
            },
            {
                id: 'pig',
                name: 'üêñ –ñ–∏—Ä',
                description: '–ñ–∏—Ä –≤ –¢–µ–º–Ω–æ—Ç–µ',
                icon: 'üêñ',
                price: 0,
                owned: true,
                type: 'appearance',
                category: 'appearance'
            },
            {
                id: 'ginger',
                name: 'ü´ö –ò–º–±–∏—Ä—å',
                description: '–ò–º–±–∏—Ä—å –≤ –¢–µ–º–Ω–æ—Ç–µ',
                icon: 'ü´ö',
                price: 0,
                owned: true,
                type: 'appearance',
                category: 'appearance'
            },
            // –£–ª—É—á—à–µ–Ω–∏—è - –ü–õ–ê–¢–ù–´–ï
            {
                id: 'flashlight_pro',
                name: 'üí° –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞',
                description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–¥–∏—É—Å –Ω–∞ 20 —Å–µ–∫—É–Ω–¥',
                icon: 'üí°',
                price: 200,
                owned: false,
                type: 'upgrade',
                category: 'upgrades'
            },
            {
                id: 'magnet',
                name: 'üß≤ –ú–∞–≥–Ω–∏—Ç –¥–ª—è —Ü–µ–ª–∏',
                description: '–ü—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç —Ü–µ–ª—å –∫ —Ü–µ–Ω—Ç—Ä—É',
                icon: 'üß≤',
                price: 180,
                owned: false,
                type: 'upgrade',
                category: 'upgrades'
            }
        ];

        // –°–ò–°–¢–ï–ú–ê –ü–†–ï–î–ú–ï–¢–û–í –î–õ–Ø –ü–û–ò–°–ö–ê
        const searchItems = {
            common: ['üîë', 'üíé', 'üì±', 'üíç', 'üî´', 'üí∞', 'üìú', 'üé≠'],
            rare: ['‚ö∞Ô∏è', 'üïµÔ∏è', 'üß©', 'üéØ', 'üèÜ', '‚≠ê', 'üîî', 'üé™'],
            special: ['üé≤', 'üëë', 'üíº', 'üóùÔ∏è', 'üëª', 'üëΩ', 'ü§ñ', 'üéÉ'],
            unique: ['üíÄ', 'üëæ', 'ü¶á', 'üç≠', 'üéÅ', 'üí£', 'üöÄ', 'üåà'],
            legendary: ['üé®', '‚ö°', 'üî•', 'üíß', 'üå™Ô∏è', '‚ùÑÔ∏è', 'üåô', '‚òÄÔ∏è']
        };

        // –†–ê–î–ò–£–°–´ –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø (—É–≤–µ–ª–∏—á–µ–Ω–∞ —Å–≤–µ—á–∞)
        const detectionRadii = {
            flashlight: 40,
            magnifier: 35,  
            candle: 35, // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 30 –¥–æ 35
            brush: 45
        };

        // –ú–ò–ù–ò–ú–ê–õ–¨–ù–ê–Ø –ß–ê–°–¢–¨ –≠–ú–û–î–ó–ò –î–õ–Ø –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø (50%)
        const MIN_DETECTION_PERCENT = 0.5;

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô –ì–õ–ê–í–ù–û–ì–û –ú–ï–ù–Æ
        startButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            startGame();
        });

        settingsButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            settingsScreen.classList.remove('hidden');
        });

        helpButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            helpScreen.classList.remove('hidden');
        });

        achievementsButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            achievementsScreen.classList.remove('hidden');
            updateAchievementsDisplay();
        });

        shopButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            shopScreen.classList.remove('hidden');
            updateShopDisplay();
        });

        closeHelpButton.addEventListener('click', () => {
            helpScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

        backButton.addEventListener('click', () => {
            settingsScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

        backFromAchievements.addEventListener('click', () => {
            achievementsScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

        backFromShop.addEventListener('click', () => {
            shopScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

        restartButton.addEventListener('click', startGame);
        
        menuButton.addEventListener('click', () => {
            resultScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });

        resumeButton.addEventListener('click', resumeGame);
        
        quitButton.addEventListener('click', () => {
            pauseScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            isGameRunning = false;
            clearInterval(gameTimer);
        });

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–ê–¢–ï–ì–û–†–ò–ô –ú–ê–ì–ê–ó–ò–ù–ê
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const category = this.dataset.category;
                updateShopDisplay(category);
            });
        });

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –Ø–ó–´–ö–û–í - –ò–°–ü–†–ê–í–õ–ï–ù–û
        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.language-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                const lang = this.dataset.lang;
                settings.language = lang;
                updateLanguage();
                saveGameData();
            });
        });

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ú–ï–ù–´ –¢–ï–ö–°–¢–ê –ù–ê –°–í–ò–ù–û–ö
        function textToPigs(text) {
            return text.split('').map(char => {
                if (char === ' ' || char === ':' || char === '~' || char === '(' || char === ')' || 
                    char === '.' || char === ',' || char === '!' || char === '?' || 
                    char.match(/[0-9]/)) {
                    return char;
                }
                return 'üêñ';
            }).join('');
        }

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –Ø–ó–´–ö–ê - –ò–°–ü–†–ê–í–õ–ï–ù–û
        function updateLanguage() {
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –Ω–∞:', settings.language);
            
            if (settings.language === 'ua') {
                // –î–ª—è —Å–≤–∏–Ω–æ–≥–æ —è–∑—ã–∫–∞
                gameTitle.textContent = textToPigs(settings.character + ' ' + settings.gameTitle);
            } else if (settings.language === 'hieroglyph') {
                // –î–ª—è –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤
                gameTitle.textContent = 'ìÅπìÇÄìÄ† ìÇßìÇãìÜëìèèìäñ';
            } else if (settings.language === 'klingon') {
                // –ö–ª–∏–Ω–≥–æ–Ω—Å–∫–∏–π
                gameTitle.textContent = 'üõ∏ tlhIngan Hol';
            } else if (settings.language === 'enochian') {
                // –ï–Ω–æ—Ö–∏–∞–Ω—Å–∫–∏–π
                gameTitle.textContent = 'üëÅÔ∏è ENOCHIAN';
            } else if (settings.language === 'sith') {
                // –°–∏—Ç—Ö—Å–∫–∏–π
                gameTitle.textContent = '‚ö° UR-KITTƒÄT';
            } else {
                // –†—É—Å—Å–∫–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
                gameTitle.textContent = settings.character + ' ' + settings.gameTitle;
            }
        }

        // –ó–ê–ì–†–£–ó–ö–ê –ù–ê–°–¢–†–û–ï–ö
        function loadSettings() {
            const handSetting = document.querySelector('input[name="hand"]:checked');
            const flashlightSetting = document.querySelector('input[name="flashlight"]:checked');
            
            if (handSetting) settings.hand = handSetting.value;
            if (flashlightSetting) settings.flashlight = flashlightSetting.value;
            
            updateToolAppearance();
        }

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–ê
        function updateToolAppearance() {
            searchTool.className = 'search-tool';
            toolBeam.innerHTML = '';
            toolBeam.className = '';
            
            const toolNames = {
                flashlight: { 
                    name: '–§–æ–Ω–∞—Ä–∏–∫', 
                    icon: settings.flashlight === 'chinese' ? 'üèÆ' : 'üî¶', 
                    beam: settings.flashlight === 'chinese' ? 'chinese-lantern-beam' : 'flashlight-beam' 
                },
                magnifier: { name: '–õ—É–ø–∞', icon: 'üîç', beam: 'magnifier-beam' },
                candle: { name: '–°–≤–µ—á–∞', icon: 'üïØÔ∏è', beam: 'candle-beam' },
                brush: { name: '–ö–∏—Å—Ç—å', icon: 'ü™•', beam: 'brush-container' }
            };
            
            const tool = toolNames[currentTool];
            
            if (currentTool === 'brush') {
                const brushContainer = document.createElement('div');
                brushContainer.className = 'brush-container';
                brushContainer.innerHTML = '<div class="brush-beam"></div>';
                toolBeam.appendChild(brushContainer);
            } else {
                toolBeam.classList.add(tool.beam);
            }
            
            toolIcon.textContent = tool.icon;
            gameTypeIndicator.textContent = `${tool.icon} ${tool.name}`;
            
            if (settings.hand === 'left') {
                searchTool.classList.add('left-handed');
            } else {
                searchTool.classList.add('right-handed');
            }
            
            updateDetectionZone();
        }

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–û–ù–´ –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø
        function updateDetectionZone() {
            let radius = detectionRadii[currentTool];
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —É–ª—É—á—à–µ–Ω–∏–∏
            if (activeUpgrades.flashlightBoost) {
                radius = Math.floor(radius * 1.5);
            }
            
            detectionZone.style.width = radius * 2 + 'px';
            detectionZone.style.height = radius * 2 + 'px';
        }

        // –ü–ê–£–ó–ê –ü–†–ò –î–í–û–ô–ù–û–ú –ù–ê–ñ–ê–¢–ò–ò
        function handleDoubleTap() {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTapTime;
            
            if (tapLength < 500 && tapLength > 0) {
                if (isPaused) {
                    resumeGame();
                } else {
                    pauseGame();
                }
            }
            lastTapTime = currentTime;
        }

        // –ü–ê–£–ó–ê –ò –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï
        function pauseGame() {
            isPaused = true;
            isGameRunning = false;
            clearInterval(gameTimer);
            pauseScreen.classList.remove('hidden');
        }

        function resumeGame() {
            isPaused = false;
            isGameRunning = true;
            pauseScreen.classList.add('hidden');
            startTimer();
        }

        // –û–ë–†–ê–ë–û–¢–ö–ê –ö–ê–°–ê–ù–ò–ô
        let isTouching = false;

        gameArea.addEventListener('touchstart', (e) => {
            if (isPaused || itemFound) return;
            e.preventDefault();
            isTouching = true;
            
            handleDoubleTap();
            
            moveSearchTool(e.touches[0]);
        });

        gameArea.addEventListener('touchmove', (e) => {
            if (isPaused || itemFound) return;
            e.preventDefault();
            if (isTouching && e.touches[0]) {
                moveSearchTool(e.touches[0]);
                
                if (currentTool === 'brush') {
                    createBrushBubbles(e.touches[0].clientX, e.touches[0].clientY);
                }
            }
        });

        gameArea.addEventListener('touchend', (e) => {
            e.preventDefault();
            isTouching = false;
        });

        // –î–í–ò–ñ–ï–ù–ò–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–ê
        function moveSearchTool(touch) {
            if (!isGameRunning) return;
            
            const x = touch.clientX - 60;
            const y = touch.clientY - 60;
            
            searchTool.style.left = x + 'px';
            searchTool.style.top = y + 'px';
            
            detectionZone.style.left = (touch.clientX - detectionRadii[currentTool]) + 'px';
            detectionZone.style.top = (touch.clientY - detectionRadii[currentTool]) + 'px';
            detectionZone.style.display = 'block';
            
            checkEmojiDetection(touch.clientX, touch.clientY);
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–†–û–í–ï–†–ö–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø –≠–ú–û–î–ó–ò –° –ó–ê–î–ï–†–ñ–ö–û–ô
        function checkEmojiDetection(centerX, centerY) {
            if (itemFound) return;
            
            let detectionRadius = detectionRadii[currentTool];
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —É–ª—É—á—à–µ–Ω–∏–∏
            if (activeUpgrades.flashlightBoost) {
                detectionRadius = Math.floor(detectionRadius * 1.5);
            }
            
            emojis.forEach(emoji => {
                const rect = emoji.getBoundingClientRect();
                const emojiX = rect.left + rect.width / 2;
                const emojiY = rect.top + rect.height / 2;
                
                const distance = Math.sqrt(
                    Math.pow(emojiX - centerX, 2) + 
                    Math.pow(emojiY - centerY, 2)
                );
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–¥–∏—É—Å —ç–º–æ–¥–∑–∏
                const emojiRadius = Math.max(rect.width, rect.height) / 2;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —ç–º–æ–¥–∑–∏ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
                // –¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á—Ç–æ–±—ã —Ö–æ—Ç—è –±—ã 50% —ç–º–æ–¥–∑–∏ –±—ã–ª–æ –≤ –∑–æ–Ω–µ
                const overlap = detectionRadius + emojiRadius - distance;
                const isEnoughOverlap = overlap >= emojiRadius * MIN_DETECTION_PERCENT;
                
                if (distance < detectionRadius + emojiRadius && isEnoughOverlap) {
                    // –≠–º–æ–¥–∑–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
                    emoji.classList.add('visible');
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ —Ü–µ–ª–µ–≤–æ–π —ç–º–æ–¥–∑–∏
                    if (emoji.textContent === currentTarget) {
                        if (!detectionTimers.has(emoji)) {
                            // –ù–∞—á–∏–Ω–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
                            startDetectionTimer(emoji, centerX, centerY);
                        }
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —á–µ—Å–Ω–æ–∫
                    if (emoji.textContent === 'üßÑ') {
                        garlicFound = true;
                        unlockAchievement('garlic');
                    }
                } else {
                    // –≠–º–æ–¥–∑–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
                    emoji.classList.remove('visible');
                    emoji.classList.remove('highlighted');
                    resetDetectionTimer(emoji);
                }
                
                // –ü—Ä–∏—Ç—è–≥–∏–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ –º–∞–≥–Ω–∏—Ç–æ–º
                if (activeUpgrades.magnet && emoji.textContent === currentTarget) {
                    const targetX = centerX - rect.width / 2;
                    const targetY = centerY - rect.height / 2;
                    
                    // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–Ω—Ç—Ä—É
                    const currentX = parseFloat(emoji.style.left);
                    const currentY = parseFloat(emoji.style.top);
                    
                    emoji.style.left = (currentX + (targetX - currentX) * 0.1) + 'px';
                    emoji.style.top = (currentY + (targetY - currentY) * 0.1) + 'px';
                }
            });
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ó–ê–ü–£–°–ö –¢–ê–ô–ú–ï–†–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø
        function startDetectionTimer(emoji, centerX, centerY) {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å
            resetDetectionTimer(emoji);
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–∞–π–º–µ—Ä–∞
            let timerElement = emoji.querySelector('.detection-timer');
            if (!timerElement) {
                timerElement = document.createElement('div');
                timerElement.className = 'detection-timer';
                emoji.appendChild(timerElement);
            }
            
            let progress = 0;
            const startTime = Date.now();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            const timerId = setInterval(() => {
                if (!isGameRunning || isPaused || itemFound) {
                    clearInterval(timerId);
                    detectionTimers.delete(emoji);
                    return;
                }
                
                const elapsed = Date.now() - startTime;
                progress = (elapsed / DETECTION_DELAY) * 100;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
                timerElement.textContent = `${Math.round(progress)}%`;
                timerElement.style.color = progress < 50 ? '#ffd700' : 
                                         progress < 80 ? '#ffa500' : '#ff6b6b';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
                emoji.classList.add('detecting');
                
                // –ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω
                if (progress >= 100) {
                    clearInterval(timerId);
                    detectionTimers.delete(emoji);
                    
                    // –£–±–∏—Ä–∞–µ–º —Ç–∞–π–º–µ—Ä
                    if (timerElement.parentNode) {
                        timerElement.parentNode.removeChild(timerElement);
                    }
                    
                    // –ù–∞—Ö–æ–¥–∏–º —Ü–µ–ª–µ–≤–æ–π –ø—Ä–µ–¥–º–µ—Ç
                    if (!itemFound && emoji.textContent === currentTarget) {
                        itemFound = true;
                        foundTargetItem(emoji);
                    }
                }
            }, 50); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 50–º—Å
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–∞–π–º–µ—Ä–∞
            detectionTimers.set(emoji, timerId);
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –°–ë–†–û–° –¢–ê–ô–ú–ï–†–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø
        function resetDetectionTimer(emoji) {
            if (detectionTimers.has(emoji)) {
                clearInterval(detectionTimers.get(emoji));
                detectionTimers.delete(emoji);
                
                // –£–±–∏—Ä–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–∞–π–º–µ—Ä–∞
                const timerElement = emoji.querySelector('.detection-timer');
                if (timerElement && timerElement.parentNode) {
                    timerElement.parentNode.removeChild(timerElement);
                }
                
                // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
                emoji.classList.remove('detecting');
            }
        }

        // –°–û–ó–î–ê–ù–ò–ï –ü–£–ó–´–†–ï–ô –î–õ–Ø –ö–ò–°–¢–ö–ò
        function createBrushBubbles(x, y) {
            const now = Date.now();
            if (now - lastBrushTime < 150) return;
            
            lastBrushTime = now;
            
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.textContent = 'ü´ß';
            bubble.style.left = (x - 10 + Math.random() * 20) + 'px';
            bubble.style.top = (y - 10 + Math.random() * 20) + 'px';
            bubble.style.fontSize = (0.6 + Math.random() * 0.4) + 'rem';
            
            gameArea.appendChild(bubble);
            brushBubbles.push(bubble);
            
            setTimeout(() => {
                if (bubble.parentNode) {
                    bubble.parentNode.removeChild(bubble);
                }
                brushBubbles = brushBubbles.filter(b => b !== bubble);
            }, 2000);
        }

        // –ù–ê–ß–ê–õ–û –ò–ì–†–´
        function startGame() {
            loadSettings();
            
            startScreen.classList.add('hidden');
            settingsScreen.classList.add('hidden');
            helpScreen.classList.add('hidden');
            achievementsScreen.classList.add('hidden');
            shopScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            pauseScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            timeLeft = gameTime;
            currentLevel = 1;
            isGameRunning = true;
            isPaused = false;
            itemFound = false;
            coins = 0;
            garlicFound = false;
            
            // –°–±—Ä–æ—Å —É–ª—É—á—à–µ–Ω–∏–π
            activeUpgrades.flashlightBoost = false;
            activeUpgrades.magnet = false;
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–µ—Ä—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
            detectionTimers.forEach(timerId => clearInterval(timerId));
            detectionTimers.clear();
            
            timerElement.textContent = `${timeLeft}—Å`;
            timerElement.classList.remove('low-time');
            levelElement.textContent = currentLevel;
            coinsElement.textContent = '0';
            
            gameArea.innerHTML = '<div class="detection-zone" id="detectionZone"></div>';
            emojis = [];
            brushBubbles = [];
            
            detectionZone.style.display = 'none';
            
            generateLevel();
            startTimer();
        }

        // –ì–ï–ù–ï–†–ê–¶–ò–Ø –£–†–û–í–ù–Ø
        function generateLevel() {
            const emojiElements = gameArea.querySelectorAll('.emoji, .bubble');
            emojiElements.forEach(el => el.remove());
            emojis = [];
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–µ—Ä—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
            detectionTimers.forEach(timerId => clearInterval(timerId));
            detectionTimers.clear();
            
            const itemTypes = Object.keys(searchItems);
            const randomType = itemTypes[Math.floor(Math.random() * itemTypes.length)];
            let availableItems = [...searchItems[randomType]];
            
            // –°–ª—É—á–∞–π–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–µ—Å–Ω–æ–∫–∞ (1 —à–∞–Ω—Å –∏–∑ 8)
            if (Math.random() < 0.125) {
                availableItems.push('üßÑ');
            }
            
            currentTarget = availableItems[Math.floor(Math.random() * availableItems.length)];
            targetEmoji.textContent = currentTarget;
            
            const usedPositions = [];
            const itemCount = 5 + Math.floor(currentLevel / 2);
            
            for (let i = 0; i < itemCount; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                
                const size = Math.max(1.8, 2.5 - currentLevel * 0.1) + 'rem';
                emoji.style.fontSize = size;
                
                let item;
                if (i === 0) {
                    item = currentTarget;
                } else {
                    let attempts = 0;
                    do {
                        item = availableItems[Math.floor(Math.random() * availableItems.length)];
                        attempts++;
                    } while (item === currentTarget && attempts < 10);
                }
                
                emoji.textContent = item;
                
                let x, y;
                let attempts = 0;
                
                do {
                    x = 40 + Math.random() * (window.innerWidth - 120);
                    y = 100 + 40 + Math.random() * (window.innerHeight - 180);
                    attempts++;
                } while (isTooClose(x, y, usedPositions) && attempts < 50);
                
                usedPositions.push({x, y});
                
                emoji.style.left = x + 'px';
                emoji.style.top = y + 'px';
                
                gameArea.appendChild(emoji);
                emojis.push(emoji);
            }

            // –°–º–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å
            const tools = ['flashlight', 'magnifier', 'candle', 'brush'];
            currentTool = tools[(currentLevel - 1) % tools.length];
            updateToolAppearance();
        }

        function isTooClose(x, y, positions) {
            for (const pos of positions) {
                const distance = Math.sqrt(Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2));
                if (distance < 80) {
                    return true;
                }
            }
            return false;
        }

        // –ù–ê–ô–î–ï–ù –¶–ï–õ–ï–í–û–ô –ü–†–ï–î–ú–ï–¢
        function foundTargetItem(emoji) {
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–µ—Ä—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
            detectionTimers.forEach(timerId => clearInterval(timerId));
            detectionTimers.clear();
            
            emoji.classList.add('item-found');
            detectionZone.style.display = 'none';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∂—ã—Ä–∫–æ–∏–Ω—ã
            coins += 10;
            coinsElement.textContent = coins;
            
            setTimeout(() => {
                itemFound = false;
                currentLevel++;
                levelElement.textContent = currentLevel;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è "—Å–∫–æ—Ä–æ—Å—Ç—Ä–µ–ª"
                if (currentLevel >= 8 && timeLeft > 0) {
                    unlockAchievement('speedster');
                }
                
                generateLevel();
            }, 800);
        }

        // –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ê –î–û–°–¢–ò–ñ–ï–ù–ò–Ø
        function unlockAchievement(achievementId) {
            const achievement = achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                saveGameData();
                console.log(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: ${achievement.name}`);
            }
        }

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –î–û–°–¢–ò–ñ–ï–ù–ò–ô
        function updateAchievementsDisplay() {
            achievementsGrid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${achievement.unlocked ? 'unlocked' : 'locked'}`;
                
                achievementElement.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-desc">${achievement.description}</div>
                    </div>
                `;
                
                achievementsGrid.appendChild(achievementElement);
            });
        }

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ú–ê–ì–ê–ó–ò–ù–ê
        function updateShopDisplay(category = 'appearance') {
            shopGrid.innerHTML = '';
            shopCoinsElement.textContent = totalCoins;
            
            const filteredItems = shopItems.filter(item => item.category === category);
            
            filteredItems.forEach(item => {
                const shopItemElement = document.createElement('div');
                let itemClass = 'shop-item';
                
                if (item.owned) {
                    itemClass += ' owned';
                } else if (totalCoins >= item.price) {
                    itemClass += ' can-afford';
                } else {
                    itemClass += ' cannot-afford';
                }
                
                shopItemElement.className = itemClass;
                
                // –°–∫—Ä—ã–≤–∞–µ–º —Ü–µ–Ω—É –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
                const priceHtml = item.price === 0 ? '' : 
                    `<div class="shop-price">
                        <span>ü™ô</span>
                        <span>${item.price}</span>
                    </div>`;
                
                shopItemElement.innerHTML = `
                    <div class="shop-icon">${item.icon}</div>
                    <div class="shop-info">
                        <div class="shop-name">${item.name}</div>
                        ${item.description ? `<div class="shop-desc">${item.description}</div>` : ''}
                        ${priceHtml}
                    </div>
                `;
                
                if (!item.owned && (item.price === 0 || totalCoins >= item.price)) {
                    shopItemElement.addEventListener('click', () => purchaseItem(item.id));
                } else if (item.owned && item.type === 'appearance') {
                    shopItemElement.addEventListener('click', () => purchaseItem(item.id));
                }
                
                shopGrid.appendChild(shopItemElement);
            });
        }

        // –ü–û–ö–£–ü–ö–ê –ü–†–ï–î–ú–ï–¢–ê - –ò–°–ü–†–ê–í–õ–ï–ù–û –î–õ–Ø –ë–ï–°–ü–õ–ê–¢–ù–´–• –ù–ê–ó–í–ê–ù–ò–ô
        function purchaseItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (!item) return;
            
            if (item.type === 'appearance') {
                // –î–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π - –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —É–∂–µ owned
                settings.character = item.icon;
                settings.gameTitle = getCharacterTitle(item.id);
                updateLanguage();
                
                // –ï—Å–ª–∏ –µ—â–µ –Ω–µ owned –∏ —ç—Ç–æ –ø–ª–∞—Ç–Ω–æ (—Ö–æ—Ç—è —Å–µ–π—á–∞—Å –≤—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
                if (!item.owned && totalCoins >= item.price) {
                    totalCoins -= item.price;
                    item.owned = true;
                }
                
                saveGameData();
                updateShopDisplay();
                totalCoinsElement.textContent = totalCoins;
                
            } else if (item.type === 'upgrade' && !item.owned && totalCoins >= item.price) {
                // –î–ª—è —É–ª—É—á—à–µ–Ω–∏–π - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞
                totalCoins -= item.price;
                item.owned = true;
                
                activateUpgrade(item.id);
                
                saveGameData();
                updateShopDisplay();
                totalCoinsElement.textContent = totalCoins;
            }
        }

        // –ê–ö–¢–ò–í–ê–¶–ò–Ø –£–õ–£–ß–®–ï–ù–ò–Ø
        function activateUpgrade(upgradeId) {
            if (upgradeId === 'flashlight_pro') {
                activeUpgrades.flashlightBoost = true;
                updateDetectionZone();
                
                // –£–ª—É—á—à–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç 20 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    activeUpgrades.flashlightBoost = false;
                    updateDetectionZone();
                }, 20000);
                
            } else if (upgradeId === 'magnet') {
                activeUpgrades.magnet = true;
            }
        }

        // –ü–û–õ–£–ß–ï–ù–ò–ï –ù–ê–ó–í–ê–ù–ò–Ø –î–õ–Ø –ü–ï–†–°–û–ù–ê–ñ–ê
        function getCharacterTitle(characterId) {
            const titles = {
                'detective': '–î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ',
                'pregnant': '–î–∞–≥–µ—Å—Ç–∞–Ω–µ—Ü –≤ –¢–µ–º–Ω–æ—Ç–µ',
                'pig': '–ñ–∏—Ä –≤ –¢–µ–º–Ω–æ—Ç–µ', 
                'ginger': '–ò–º–±–∏—Ä—å –≤ –¢–µ–º–Ω–æ—Ç–µ'
            };
            return titles[characterId] || '–î–µ—Ç–µ–∫—Ç–∏–≤ –≤ –¢–µ–º–Ω–æ—Ç–µ';
        }

        // –¢–ê–ô–ú–ï–†
        function startTimer() {
            clearInterval(gameTimer);
            gameTimer = setInterval(() => {
                if (!isPaused && isGameRunning) {
                    timeLeft--;
                    timerElement.textContent = `${timeLeft}—Å`;
                    
                    if (timeLeft <= 10) {
                        timerElement.classList.add('low-time');
                    }
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }
            }, 1000);
        }

        // –ö–û–ù–ï–¶ –ò–ì–†–´
        function endGame() {
            isGameRunning = false;
            clearInterval(gameTimer);
            
            // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–π–º–µ—Ä—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
            detectionTimers.forEach(timerId => clearInterval(timerId));
            detectionTimers.clear();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∂—ã—Ä–∫–æ–∏–Ω—ã
            totalCoins += coins;
            totalCoinsElement.textContent = totalCoins;
            earnedCoinsElement.textContent = coins;
            
            saveGameData();
            
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            const score = currentLevel - 1;
            let message = `–í—ã –ø—Ä–æ—à–ª–∏ ${score} —É—Ä–æ–≤–Ω–µ–π! `;
            
            if (score <= 3) message += "–ù–æ–≤–∏—á–æ–∫-–¥–µ—Ç–µ–∫—Ç–∏–≤!";
            else if (score <= 7) message += "–û–ø—ã—Ç–Ω—ã–π —Å—ã—â–∏–∫!";
            else message += "–í–µ–ª–∏–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤!";
            
            resultMessage.textContent = message;
        }

        // –ó–ê–ì–†–£–ó–ö–ê –°–û–•–†–ê–ù–ï–ù–ù–´–• –î–ê–ù–ù–´–•
        function loadGameData() {
            const savedData = localStorage.getItem('detectiveGameData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    totalCoins = data.totalCoins || 0;
                    totalCoinsElement.textContent = totalCoins;
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                    if (data.achievements) {
                        data.achievements.forEach(savedAchievement => {
                            const achievement = achievements.find(a => a.id === savedAchievement.id);
                            if (achievement) {
                                achievement.unlocked = savedAchievement.unlocked;
                            }
                        });
                    }
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
                    if (data.shopItems) {
                        data.shopItems.forEach(savedItem => {
                            const item = shopItems.find(i => i.id === savedItem.id);
                            if (item) {
                                item.owned = savedItem.owned;
                            }
                        });
                    }
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    if (data.settings) {
                        settings = { ...settings, ...data.settings };
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
                        document.querySelectorAll('.language-option').forEach(opt => {
                            if (opt.dataset.lang === settings.language) {
                                opt.classList.add('selected');
                            } else {
                                opt.classList.remove('selected');
                            }
                        });
                        
                        updateLanguage();
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                }
            } else {
                // –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –¥–µ–ª–∞–µ–º –≤—Å–µ –Ω–∞–∑–≤–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏
                shopItems.forEach(item => {
                    if (item.category === 'appearance') {
                        item.owned = true;
                    }
                });
                saveGameData();
            }
        }

        function saveGameData() {
            const data = {
                totalCoins: totalCoins,
                achievements: achievements.map(a => ({ id: a.id, unlocked: a.unlocked })),
                shopItems: shopItems.map(i => ({ id: i.id, owned: i.owned })),
                settings: settings
            };
            localStorage.setItem('detectiveGameData', JSON.stringify(data));
        }

        // –ê–î–ê–ü–¢–ê–¶–ò–Ø –ö –†–ê–ó–ú–ï–†–£ –≠–ö–†–ê–ù–ê
        window.addEventListener('resize', () => {
            if (isGameRunning) generateLevel();
        });

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        loadGameData();
        
        window.addEventListener('beforeunload', saveGameData);

        console.log('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç');
    </script>
</body>
</html>
